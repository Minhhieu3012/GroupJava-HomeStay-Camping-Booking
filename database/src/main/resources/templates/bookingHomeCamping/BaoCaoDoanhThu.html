<!--<!DOCTYPE html>-->
<!--<html lang="en">-->

<!--<head>-->
<!--    <div th:replace="master/css::css"></div>-->
<!--</head>-->

<!--<body>-->
<!--<div class="container-xxl bg-white p-0">-->

<!--&lt;!&ndash;    <th:block th:fragment="content">&ndash;&gt;-->
<!--        &lt;!&ndash;Nội dung trang con &ndash;&gt;-->
<!--        <th:block>-->
<!--        <div class="container-xxl bg-white p-0">-->

<!--            <div class="container-fluid bg-dark px-0">-->
<!--                <div class="row gx-0">-->
<!--                    <div th:replace="master/logo::logo"></div>-->

<!--                    <div class="col-lg-9">-->
<!--                        <div th:replace="master/header::header"></div>-->

<!--                        <div th:replace="master/navbar::navbar"></div>-->
<!--                    </div>-->
<!--                </div>-->
<!--            </div>-->

<!--            <th:block th:fragment="content">-->
<!--                <h1>Báo cáo doanh thu</h1>-->

<!--                &lt;!&ndash; Bảng số liệu &ndash;&gt;-->
<!--                <div class="report">-->
<!--                    <h2 class="report-title">Bảng số liệu</h2>-->
<!--                    <div class="cards">-->
<!--                        <div class="card">-->
<!--                            <h3>Tổng doanh thu</h3>-->
<!--                            <p id="totalRevenue">0 VND</p>-->
<!--                        </div>-->
<!--                        <div class="card">-->
<!--                            <h3>Phí quản lý (20%)</h3>-->
<!--                            <p id="adminFee">0 VND</p>-->
<!--                        </div>-->
<!--                        <div class="card">-->
<!--                            <h3>Tỷ lệ lấp đầy</h3>-->
<!--                            <p id="fillRate">0%</p>-->
<!--                        </div>-->
<!--                    </div>-->
<!--                </div>-->

<!--                &lt;!&ndash; Biểu đồ doanh thu &ndash;&gt;-->
<!--                <h3>Biểu đồ doanh thu theo tháng</h3>-->
<!--                <canvas id="revenueChart" width="600" height="300"></canvas>-->
<!--                <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>-->
<!--                <script>-->
<!--                    fetch('/api/reports')  // đúng URL controller đang cung cấp-->
<!--                        .then(res => res.json())-->
<!--                        .then(data => {-->
<!--                            const labels = data.map(item => {-->
<!--                                const date = new Date(item.reportDate);-->
<!--                                return `Tháng ${date.getMonth() + 1}/${date.getFullYear()}`;-->
<!--                            });-->

<!--                            const revenues = data.map(item => parseFloat(item.totalRevenue));-->

<!--                            const ctx = document.getElementById('revenueChart').getContext('2d');-->
<!--                            new Chart(ctx, {-->
<!--                                type: 'bar',-->
<!--                                data: {-->
<!--                                    labels: labels,-->
<!--                                    datasets: [{-->
<!--                                        label: 'Doanh thu (VND)',-->
<!--                                        data: revenues,-->
<!--                                        backgroundColor: 'rgba(75, 192, 192, 0.6)'-->
<!--                                    }]-->
<!--                                },-->
<!--                                options: {-->
<!--                                    scales: {-->
<!--                                        y: {-->
<!--                                            beginAtZero: true,-->
<!--                                            ticks: {-->
<!--                                                callback: value => value.toLocaleString('vi-VN') + ' VND'-->
<!--                                            }-->
<!--                                        }-->
<!--                                    }-->
<!--                                }-->
<!--                            });-->

<!--                            // Hiển thị số liệu tổng-->
<!--                            const total = revenues.reduce((a, b) => a + b, 0);-->
<!--                            const adminFee = total * 0.2;-->

<!--                            // Giả sử muốn lấy tỷ lệ lấp đầy từ bản ghi gần nhất-->
<!--                            const fillRate = data.length > 0 ? parseFloat(data[data.length - 1].occupancyRate) : 0;-->

<!--                            document.getElementById('totalRevenue').innerText = total.toLocaleString('vi-VN') + ' VND';-->
<!--                            document.getElementById('adminFee').innerText = adminFee.toLocaleString('vi-VN') + ' VND';-->
<!--                            document.getElementById('fillRate').innerText = Math.round(fillRate * 100) + '%';-->
<!--                        })-->
<!--                        .catch(err => console.error('Lỗi khi gọi API báo cáo:', err));-->
<!--                </script>-->
<!--            </th:block>-->

<!--            <div th:replace="master/footer::footer"></div>-->
<!--            <a href="home" class="btn btn-lg btn-primary btn-lg-square back-to-top"><i class="bi bi-arrow-up"></i></a>-->

<!--        </div>-->
<!--    </th:block>-->
<!--    <a href="home" class="btn btn-lg btn-primary btn-lg-square back-to-top"><i class="bi bi-arrow-up"></i></a>-->

<!--</div>-->


<!--</body>-->

<!--</html>-->

<!DOCTYPE html>
<html lang="en">

<head>
    <div th:replace="master/css::css"></div>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>
<div class="container-xxl bg-white p-0">

    <!-- Không cần th:block ở đây nếu không include từ nơi khác -->
    <div class="container-xxl bg-white p-0">

        <div class="container-fluid bg-dark px-0">
            <div class="row gx-0">
                <div th:replace="master/logo::logo"></div>

                <div class="col-lg-9">
                    <div th:replace="master/header::header"></div>
                    <div th:replace="master/navbar::navbar"></div>
                </div>
            </div>
        </div>

        <h1>Báo cáo doanh thu</h1>

        <!-- Bảng số liệu -->
        <div class="report">
            <h2 class="report-title">Bảng số liệu</h2>
            <div class="cards">
                <div class="card">
                    <h3>Tổng doanh thu</h3>
                    <p id="totalRevenue">0 VND</p>
                </div>
                <div class="card">
                    <h3>Phí quản lý (20%)</h3>
                    <p id="adminFee">0 VND</p>
                </div>
                <div class="card">
                    <h3>Tỷ lệ lấp đầy</h3>
                    <p id="fillRate">0%</p>
                </div>
            </div>
        </div>

        <!-- Biểu đồ doanh thu -->
        <h3>Biểu đồ doanh thu theo tháng</h3>
        <canvas id="revenueChart" width="600" height="300"></canvas>

        <div th:replace="master/footer::footer"></div>
        <a href="home" class="btn btn-lg btn-primary btn-lg-square back-to-top"><i class="bi bi-arrow-up"></i></a>

    </div>

    <script>
        fetch('/api/reports')
            .then(res => res.json())
            .then(data => {
                console.log("Dữ liệu:", data); // <- Gợi ý debug

                const labels = data.map(item => {
                    const date = new Date(item.reportDate);
                    return `Tháng ${date.getMonth() + 1}/${date.getFullYear()}`;
                });

                const revenues = data.map(item => parseFloat(item.totalRevenue));

                const ctx = document.getElementById('revenueChart').getContext('2d');
                new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'Doanh thu (VND)',
                            data: revenues,
                            backgroundColor: 'rgba(75, 192, 192, 0.6)'
                        }]
                    },
                    options: {
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    callback: value => value.toLocaleString('vi-VN') + ' VND'
                                }
                            }
                        }
                    }
                });

                // Hiển thị số liệu tổng
                const total = revenues.reduce((a, b) => a + b, 0);
                const adminFee = total * 0.2;

                const fillRate = data.length > 0 ? parseFloat(data[data.length - 1].occupancyRate) : 0;

                document.getElementById('totalRevenue').innerText = total.toLocaleString('vi-VN') + ' VND';
                document.getElementById('adminFee').innerText = adminFee.toLocaleString('vi-VN') + ' VND';
                document.getElementById('fillRate').innerText = Math.round(fillRate * 100) + '%';
            })
            .catch(err => console.error('Lỗi khi gọi API báo cáo:', err));
    </script>

</div>
</body>

</html>
